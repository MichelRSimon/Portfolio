<!DOCTYPE html>
<html lang="pt-BR">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Portifólio Digital</title>
        <link rel="stylesheet" href="css/style.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    </head>
    <body>
        <!-- Banner do topo -->
        <header class="header-with-banner">
            <div class="top-banner">
                <img src="img/banner001.png" alt="Banner do topo" class="banner-image"> <!---->
                     <div class="banner-text">
                         <h3>Bem-<span>vindo</span></h3>
    <p><stromg>Oi, eu sou Michel!</stromg>  
Transformo café + código em coisas que funcionam. Estou no início da jornada, mas já bagunço bem o DevTools.</p>
                    </div>
                </div>
                    <nav class="nav-menu">
                        <ul>
                            <li><a href="index.html">Home</a></li>
                            <li><a href="sobre.html">Sobre</a></li>
                            <li><a href="Projetos.html">Projetos</a></li>
                            <li><a href="contato.html">Contato</a></li>
                        </ul>
                    </nav>
                <div class="mobile-menu">
                    <i class="fas fa-bars"></i>
                </div>
            </header>
        <main>

            <!--O conteúdo específico de cada página vai aqui -->

        </main>
            <!--Rodapé-->
        <footer>
            <div class="container">
                <div class="footer-content">
                    <div class="footer-section about">
                        <h3>Sobre Mim</h3>
                        <p>Estudante de tecnologia digital apaixonado por criar soluções inovadoras e funcionais para a web.</p>
                        <div class="socials">
                            <a href="https://www.linkedin.com/in/mrsimon-undefined-4b536723a/" target="_blank" rel="noopener noreferrer"><img src="https://icons.getbootstrap.com/assets/icons/linkedin.svg" alt="LinkedIn" width="20" height="15"></a>
                            <a href="https://github.com/MichelRSimon" target="_blank" rel="noopener noreferrer"><img src="https://icons.getbootstrap.com/assets/icons/github.svg" alt="GitHub" width="20" height="15"></a>
                            <a href="https://www.instagram.com/michelr.simon/" target="_blank" rel="noopener noreferrer"><img src="https://icons.getbootstrap.com/assets/icons/instagram.svg" alt="Instagram" width="20" height="15"></a>
                        </div>
                    </div>
                    <div class="footer-section links">
                        <h3>Links Úteis</h3>
                        <ul>
                            <li><a href="index.html">Home</a></li>
                            <li><a href="sobre.html">Sobre</a></li>
                            <li><a href="clientes.html">Clientes</a></li>
                            <li><a href="contato.html">Contato</a></li>
                        </ul>
                    </div>
                    <div class="footer-section contact">
                        <h3>Contato</h3>
                        <p><i class="fas fa-envelope"></i>michelrhossa@gmail.com</p>
                        <p><i class="fas fa-phone"></i>(22)99276-5778</p>
                    </div>
                    <div class="footer-bottom">
                        <p>&copy; 2025 Portfólio Digital. Todos os direitos reservados.</p>
                    </div>
                </div>
            </div>
        </footer>

        <!-- Chatbot Flutuante com IA -->
    <div class="chatbot-container">
        <button class="chatbot-btn">
            <i class="fas fa-comment-dots"></i>
        </button>
        <div class="chatbot-window">
            <div class="chatbot-header">
                <div class="chatbot-header-content">
                    <div class="chatbot-status"></div>
                    <h3>Assistente Virtual</h3>
                </div>
                <div>
                    <button class="chatbot-settings" title="Configurações">
                        <i class="fas fa-cog"></i>
                    </button>
                    <button class="chatbot-history-btn" title="Histórico">
                        <i class="fas fa-history"></i>
                    </button>
                    <button class="chatbot-close">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            
            <div class="chatbot-channels">
                <button class="channel-btn active" data-channel="general">Geral</button>
                <button class="channel-btn" data-channel="support">Suporte</button>
                <button class="channel-btn" data-channel="sales">Vendas</button>
            </div>
            
            <div class="chatbot-messages">
                <div class="message bot-message">
                    Olá! Sou seu assistente virtual. Como posso ajudá-lo hoje?
                    <div class="message-time" id="current-time"></div>
                </div>
                <div class="chatbot-typing" style="display: none;">
                    <span>Digitando</span>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                </div>
            </div>
            
            <div class="chatbot-input-container">
                <input type="text" class="chatbot-input" placeholder="Digite sua mensagem...">
                <button class="chatbot-send">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Modal para configuração de API Key -->
    <div class="api-key-modal">
        <div class="api-key-content">
            <h3>Configuração da API OpenAI</h3>
            <p>Para usar respostas de IA, você precisa configurar sua API Key.</p>
            <input type="password" class="api-key-input" placeholder="Cole sua API Key aqui">
            <div class="api-key-buttons">
                <button class="api-key-btn btn-secondary" id="close-api-modal">Cancelar</button>
                <button class="api-key-btn btn-primary" id="save-api-key">Salvar</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Elementos do DOM
            const chatbotBtn = document.querySelector('.chatbot-btn');
            const chatbotWindow = document.querySelector('.chatbot-window');
            const chatbotClose = document.querySelector('.chatbot-close');
            const chatInput = document.querySelector('.chatbot-input');
            const chatSendBtn = document.querySelector('.chatbot-send');
            const chatMessages = document.querySelector('.chatbot-messages');
            const typingIndicator = document.querySelector('.chatbot-typing');
            const channelButtons = document.querySelectorAll('.channel-btn');
            const settingsBtn = document.querySelector('.chatbot-settings');
            const historyBtn = document.querySelector('.chatbot-history-btn');
            const apiKeyModal = document.querySelector('.api-key-modal');
            const apiKeyInput = document.querySelector('.api-key-input');
            const saveApiKeyBtn = document.querySelector('#save-api-key');
            const closeApiModalBtn = document.querySelector('#close-api-modal');
            
            // Variáveis de estado
            let currentChannel = 'general';
            let conversationHistory = [];
            let apiKey = localStorage.getItem('openai_api_key');
            
            // Configurar hora atual na mensagem de boas-vindas
            document.getElementById('current-time').textContent = getCurrentTime();
            
            // Inicializar histórico de conversas
            loadConversationHistory();
            
            // Abrir/fechar o chatbot
            chatbotBtn.addEventListener('click', function() {
                chatbotWindow.style.display = chatbotWindow.style.display === 'flex' ? 'none' : 'flex';
            });
            
            chatbotClose.addEventListener('click', function() {
                chatbotWindow.style.display = 'none';
            });
            
            // Trocar de canal
            channelButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    channelButtons.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentChannel = this.dataset.channel;
                    addMessage(`Canal alterado para: ${getChannelName(currentChannel)}`, 'bot');
                });
            });
            
            // Botão de configurações
            settingsBtn.addEventListener('click', function() {
                apiKeyModal.style.display = 'flex';
                apiKeyInput.value = apiKey || '';
            });
            
            // Fechar modal de API Key
            closeApiModalBtn.addEventListener('click', function() {
                apiKeyModal.style.display = 'none';
            });
            
            // Salvar API Key
            saveApiKeyBtn.addEventListener('click', function() {
                apiKey = apiKeyInput.value.trim();
                if (apiKey) {
                    localStorage.setItem('openai_api_key', apiKey);
                    apiKeyModal.style.display = 'none';
                    addMessage('Chave API configurada com sucesso!', 'bot');
                }
            });
            
            // Botão de histórico
            historyBtn.addEventListener('click', function() {
                if (conversationHistory.length > 0) {
                    const historyText = conversationHistory.map(entry => 
                        `${entry.role === 'user' ? 'Você' : 'Assistente'}: ${entry.content}`
                    ).join('\n');
                    
                    alert('Histórico da conversa:\n\n' + historyText);
                } else {
                    alert('Nenhum histórico de conversa disponível.');
                }
            });
            
            // Enviar mensagem
            function sendMessage() {
                const message = chatInput.value.trim();
                if (message) {
                    // Adicionar mensagem do usuário
                    addMessage(message, 'user');
                    conversationHistory.push({ role: 'user', content: message, channel: currentChannel });
                    saveConversationHistory();
                    
                    chatInput.value = '';
                    
                    // Verificar se é um comando especial
                    if (message.startsWith('/')) {
                        handleCommand(message);
                        return;
                    }
                    
                    // Simular resposta do bot
                    setTimeout(() => {
                        typingIndicator.style.display = 'flex';
                        
                        // Se temos API Key, usar IA, senão resposta padrão
                        if (apiKey) {
                            getAIResponse(message)
                                .then(aiResponse => {
                                    typingIndicator.style.display = 'none';
                                    addMessage(aiResponse, 'bot');
                                    conversationHistory.push({ role: 'assistant', content: aiResponse, channel: currentChannel });
                                    saveConversationHistory();
                                })
                                .catch(error => {
                                    typingIndicator.style.display = 'none';
                                    addMessage('Desculpe, ocorreu um erro ao processar sua mensagem.', 'bot');
                                    console.error('Erro na API:', error);
                                });
                        } else {
                            setTimeout(() => {
                                typingIndicator.style.display = 'none';
                                const response = getDefaultResponse(message);
                                addMessage(response, 'bot');
                                conversationHistory.push({ role: 'assistant', content: response, channel: currentChannel });
                                saveConversationHistory();
                            }, 1500);
                        }
                    }, 500);
                }
            }
            
            // Event listeners para enviar mensagem
            chatSendBtn.addEventListener('click', sendMessage);
            
            chatInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });
            
            // Adicionar mensagem ao chat
            function addMessage(text, sender) {
                const messageElement = document.createElement('div');
                messageElement.classList.add('message', `${sender}-message`);
                
                const messageContent = document.createElement('div');
                messageContent.textContent = text;
                messageElement.appendChild(messageContent);
                
                const timeElement = document.createElement('div');
                timeElement.classList.add('message-time');
                timeElement.textContent = getCurrentTime();
                messageElement.appendChild(timeElement);
                
                chatMessages.appendChild(messageElement);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
            
            // Obter resposta da API OpenAI
            async function getAIResponse(message) {
                try {
                    const response = await fetch('https://api.openai.com/v1/chat/completions', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${apiKey}`
                        },
                        body: JSON.stringify({
                            model: 'gpt-3.5-turbo',
                            messages: [
                                { 
                                    role: 'system', 
                                    content: `Você é um assistente virtual útil que está integrado a um site de portfólio de desenvolvedor. 
                                    O usuário está no canal: ${getChannelName(currentChannel)}. 
                                    Responda de forma concisa e útil.`
                                },
                                ...conversationHistory.slice(-10).map(msg => ({
                                    role: msg.role,
                                    content: msg.content
                                })),
                                { role: 'user', content: message }
                            ],
                            max_tokens: 150,
                            temperature: 0.7
                        })
                    });
                    
                    if (!response.ok) {
                        throw new Error(`Erro na API: ${response.status} ${response.statusText}`);
                    }
                    
                    const data = await response.json();
                    return data.choices[0].message.content.trim();
                } catch (error) {
                    console.error('Erro ao chamar API OpenAI:', error);
                    throw error;
                }
            }
            
            // Respostas padrão (fallback)
            function getDefaultResponse(message) {
                const lowerMsg = message.toLowerCase();
                
                if (lowerMsg.includes('olá') || lowerMsg.includes('oi') || lowerMsg.includes('ola')) {
                    return 'Olá! Como posso ajudá-lo? Para respostas mais inteligentes, configure sua API Key nas configurações.';
                } else if (lowerMsg.includes('portfolio') || lowerMsg.includes('projeto')) {
                    return 'Você pode ver meus projetos na página principal do portfólio.';
                } else if (lowerMsg.includes('contato') || lowerMsg.includes('email')) {
                    return 'Você pode me contatar pelo email michelrhossa@gmail.com ou pelo telefone (22)99276-5778.';
                } else if (lowerMsg.includes('serviço') || lowerMsg.includes('freela')) {
                    return 'Ofereço serviços de desenvolvimento web e design. Entre em contato para mais detalhes!';
                } else if (lowerMsg.includes('api') || lowerMsg.includes('key')) {
                    return 'Para configurar sua API Key, clique no ícone de engrenagem no canto superior direito do chat.';
                } else {
                    return 'Obrigado pelo seu interesse. Como posso ajudá-lo? Para respostas mais inteligentes, configure sua API Key nas configurações.';
                }
            }
            
            // Manipular comandos especiais
            function handleCommand(command) {
                typingIndicator.style.display = 'flex';
                
                setTimeout(() => {
                    typingIndicator.style.display = 'none';
                    
                    switch(command.toLowerCase()) {
                        case '/clear':
                            chatMessages.innerHTML = '';
                            addMessage('Histórico de mensagens limpo.', 'bot');
                            break;
                        case '/history':
                            if (conversationHistory.length > 0) {
                                const historyText = conversationHistory.map(entry => 
                                    `${entry.role === 'user' ? 'Você' : 'Assistente'}: ${entry.content}`
                                ).join('\n');
                                
                                addMessage('Histórico da conversa (verifique o alerta):', 'bot');
                                setTimeout(() => {
                                    alert('Histórico da conversa:\n\n' + historyText);
                                }, 300);
                            } else {
                                addMessage('Nenhum histórico de conversa disponível.', 'bot');
                            }
                            break;
                        case '/help':
                            addMessage('Comandos disponíveis:\n/clear - Limpar chat\n/history - Ver histórico\n/help - Mostrar ajuda', 'bot');
                            break;
                        default:
                            addMessage('Comando não reconhecido. Digite /help para ver os comandos disponíveis.', 'bot');
                    }
                }, 1000);
            }
            
            // Funções utilitárias
            function getCurrentTime() {
                const now = new Date();
                return `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
            }
            
            function getChannelName(channel) {
                const channels = {
                    'general': 'Geral',
                    'support': 'Suporte',
                    'sales': 'Vendas'
                };
                return channels[channel] || 'Geral';
            }
            
            function saveConversationHistory() {
                // Limitar o histórico aos 50 últimos itens para não sobrecarregar o localStorage
                if (conversationHistory.length > 50) {
                    conversationHistory = conversationHistory.slice(-50);
                }
                localStorage.setItem('chat_history', JSON.stringify(conversationHistory));
            }
            
            function loadConversationHistory() {
                const savedHistory = localStorage.getItem('chat_history');
                if (savedHistory) {
                    conversationHistory = JSON.parse(savedHistory);
                }
            }
        });
        </script>
    </body>
</html>
